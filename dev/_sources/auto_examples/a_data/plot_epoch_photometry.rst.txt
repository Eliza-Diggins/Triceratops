
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/a_data/plot_epoch_photometry.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_a_data_plot_epoch_photometry.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_a_data_plot_epoch_photometry.py:


====================================
Plot Radio Photometry Epochs
====================================

This example will demonstrate how to load radio photometry data and separate it into epochs for
plotting using the Triceratops library. We'll utilize the :class:`data.photometry.RadioPhotometryContainer`
to manage and visualize the data.

.. GENERATED FROM PYTHON SOURCE LINES 12-15

Setup
-----
First, we need to import the necessary libraries and set up the plotting style.

.. GENERATED FROM PYTHON SOURCE LINES 15-21

.. code-block:: Python

    import matplotlib.pyplot as plt
    from astropy import units as u

    from triceratops.data.photometry import RadioPhotometryContainer
    from triceratops.utils.plot_utils import set_plot_style








.. GENERATED FROM PYTHON SOURCE LINES 22-29

We'll use a set of synthetically generated radio photometry data for this example. The data is
stored in the ``_data/example_photometry.fits`` file within the documentation source directory.

This dataset is almost in the perfect format for loading into a
:class:`data.photometry.RadioPhotometryContainer`, except that it doesn't have an explicit ``time`` column, so
we will need to select one. We also need to give a reference time for the observations, which we will set to the JD
of the first observation.

.. GENERATED FROM PYTHON SOURCE LINES 29-46

.. code-block:: Python


    # Resolve the path to the dataset. In this case, we seek out the data in the
    # documentation.
    data_file = "../../../../../docs/source/_data/example_photometry.fits"

    # Load the dataset as a RadioPhotometryContainer. We specify that the ``time`` column
    # should be taken from the ``time_midobs`` column in the dataset.
    photometry_data = RadioPhotometryContainer.from_file(
        data_file,
        column_map={"time_midobs": "time"},
        time_starts=2458368.45645 * u.day,  # Reference time (JD of first observation)
    )
    print(f"Loaded photometry data with {len(photometry_data)} entries.")

    # Render the table into the documentation.
    photometry_data.table.pprint()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Loaded photometry data with 62 entries.
        obs_name         flux_density      ... beam_minor_axis beam_angle
           na                 Jy           ...      arcsec        deg    
    --------------- ---------------------- ... --------------- ----------
    obs1_L_band1of2  0.0008397371110273543 ...           24.74      -20.9
    obs1_L_band2of2   0.001380642947400138 ...           18.27      -17.5
    obs1_S_band1of2  0.0023957298217117994 ...           12.36      -17.5
    obs1_S_band2of2  0.0037334616541369017 ...            9.71      -14.4
    obs1_C_band1of2   0.004921986879267783 ...            7.03      -18.7
    obs1_C_band2of2   0.007578309663898102 ...            5.09      -15.9
    obs1_X_band1of2   0.010537084131965368 ...            3.98      -19.2
    obs1_X_band2of2    0.01055208615971873 ...            3.46      -21.1
    obs1_K_band1of4    0.00821531350281548 ...            2.65      -66.2
                ...                    ... ...             ...        ...
             obs8_L                     -- ...            1.26         54
             obs8_S                     -- ...            0.64       19.4
             obs8_X                     -- ...             0.2       31.8
           obsg1_b5  0.0004268404374563874 ...            2.24       78.1
           obsg1_b3                     -- ...            6.96         80
           obsg2_g5                     -- ...            2.34       60.2
           obsg2_b4 0.00023375250854007943 ...             4.4       81.6
           obsg2_b3                     -- ...            7.74       70.8
           obsg3_b4                     -- ...            3.94       46.2
           obsg3_b3                     -- ...            7.54       86.7
    Length = 62 rows




.. GENERATED FROM PYTHON SOURCE LINES 47-50

Now that we have loaded the data, we can plot it. The :class:`~data.photometry.RadioPhotometryContainer`
includes a built-in plotting method that makes this straightforward:
:meth:`~data.photometry.RadioPhotometryContainer.plot_photometry`.

.. GENERATED FROM PYTHON SOURCE LINES 50-63

.. code-block:: Python


    # Set the plot style.
    set_plot_style()

    # Create a figure and axes for the plot.
    fig, ax = plt.subplots(figsize=(10, 6))

    # Plot the photometry data.
    photometry_data.plot_photometry(fig=fig, axes=ax, show_upper_limits=True)

    # Customize the plot.
    fig.show()




.. image-sg:: /auto_examples/a_data/images/sphx_glr_plot_epoch_photometry_001.png
   :alt: plot epoch photometry
   :srcset: /auto_examples/a_data/images/sphx_glr_plot_epoch_photometry_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 64-70

As you may notice, the data points (even sorted by color) are not all that easy to pick apart. Let's instead
plot the empirical SEDs at different epochs to better visualize the evolution of the radio emission over time.
To do this, we'll need to use the built-in epoching functionality of the
:class:`~data.photometry.RadioPhotometryContainer`.

Let's first look at the various time ranges covered by the data:

.. GENERATED FROM PYTHON SOURCE LINES 70-79

.. code-block:: Python


    # Create a histogram of observation times.
    fig, ax = plt.subplots(figsize=(10, 4))
    _, edges, _ = ax.hist(photometry_data.time.to_value(u.day), bins=60, color="skyblue", edgecolor="black")
    ax.set_xlabel("Time since explosion (days)")
    ax.set_ylabel("Number of observations")
    ax.set_title("Histogram of Observation Times")
    fig.show()




.. image-sg:: /auto_examples/a_data/images/sphx_glr_plot_epoch_photometry_002.png
   :alt: Histogram of Observation Times
   :srcset: /auto_examples/a_data/images/sphx_glr_plot_epoch_photometry_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 80-87

If you already have clearly defined epochs in mind, you can specify them directly in your table using the
``epoch_id`` column, or you can use the built-in method
:meth:`~data.photometry.RadioPhotometryContainer.set_epochs_from_indices`; however, we do not have that information here.

Instead, we can use the :meth:`~data.photometry.RadioPhotometryContainer.set_epochs_from_time_gaps` method to
automatically define epochs based on gaps in the observation times. We'll specify a gap threshold of 2 days to
separate the epochs.

.. GENERATED FROM PYTHON SOURCE LINES 87-113

.. code-block:: Python


    # Set epochs based on time gaps of 2 days.
    photometry_data.set_epochs_from_time_gaps(max_gap=2.0 * u.day)

    # Create another set of histograms, this time colored by epoch.
    fig, ax = plt.subplots(figsize=(10, 4))
    num_epochs = photometry_data.n_epochs
    colors = plt.get_cmap("rainbow")

    for epoch_id in range(num_epochs):
        epoch_mask = photometry_data.get_epoch_mask(epoch_id)
        ax.hist(
            photometry_data.time[epoch_mask].to_value(u.day),
            bins=edges,
            alpha=0.6,
            label=f"Epoch {epoch_id + 1}",
            color=colors(epoch_id / num_epochs),
            edgecolor="black",
        )

    ax.set_xlabel("Time since explosion (days)")
    ax.set_ylabel("Number of observations")
    ax.set_title("Histogram of Observation Times by Epoch")
    ax.legend()
    fig.show()




.. image-sg:: /auto_examples/a_data/images/sphx_glr_plot_epoch_photometry_003.png
   :alt: Histogram of Observation Times by Epoch
   :srcset: /auto_examples/a_data/images/sphx_glr_plot_epoch_photometry_003.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 114-115

Now that we have defined each of the epochs, we can plot the SEDs for each epoch using the epoch masks.

.. GENERATED FROM PYTHON SOURCE LINES 115-143

.. code-block:: Python


    fig, axes = plt.subplots(figsize=(10, 6))

    for epoch_id in range(num_epochs):
        epoch_mask = photometry_data.get_epoch_mask(epoch_id)

        freq, flux, err = (
            photometry_data.freq[epoch_mask].to_value(u.Hz),
            photometry_data.flux_density[epoch_mask].to_value(u.mJy),
            photometry_data.flux_density_error[epoch_mask].to_value(u.mJy),
        )

        # Sort by frequency so that things are in order.
        sorted_indices = freq.argsort()
        freq = freq[sorted_indices]
        flux = flux[sorted_indices]
        err = err[sorted_indices]

        # Plot the SED for this epoch.
        # sphinx_gallery_thumbnail_number = -1
        axes.errorbar(freq, flux, yerr=err, fmt="o-", color=colors(epoch_id / num_epochs))

    axes.set_xscale("log")
    axes.set_yscale("log")
    axes.set_xlabel("Frequency (Hz)")
    axes.set_ylabel("Flux Density (mJy)")
    axes.set_title("Radio SEDs at Different Epochs")
    fig.show()



.. image-sg:: /auto_examples/a_data/images/sphx_glr_plot_epoch_photometry_004.png
   :alt: Radio SEDs at Different Epochs
   :srcset: /auto_examples/a_data/images/sphx_glr_plot_epoch_photometry_004.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.337 seconds)


.. _sphx_glr_download_auto_examples_a_data_plot_epoch_photometry.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_epoch_photometry.ipynb <plot_epoch_photometry.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_epoch_photometry.py <plot_epoch_photometry.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_epoch_photometry.zip <plot_epoch_photometry.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
