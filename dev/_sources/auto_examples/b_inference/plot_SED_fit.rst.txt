
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/b_inference/plot_SED_fit.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_b_inference_plot_SED_fit.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_b_inference_plot_SED_fit.py:


====================================
Fit Radio Photometry to a BPL
====================================

In this example, we'll do the simplest possible SED fit to radio photometry data using a broken power-law (BPL) model.
This is an excellent place to start for understanding how to fit models to data using the Triceratops library.

We'll use the :class:`~models.emission.synchrotron.Synchrotron_SSA_SBPL_SED` model to generate some synthetic
data with a fixed noise threshold and then we'll invert that data to recover the original parameters using MCMC.
This will take us through the basic steps of generating the model, defining the dataset, setting up the likelihood,
and running the inference with correct priors.

.. GENERATED FROM PYTHON SOURCE LINES 14-18

.. code-block:: Python


    import numpy as np
    from astropy import units as u








.. GENERATED FROM PYTHON SOURCE LINES 19-22

Setup
-----
First, we need to import the necessary libraries

.. GENERATED FROM PYTHON SOURCE LINES 22-24

.. code-block:: Python

    from triceratops.models.emission.synchrotron import Synchrotron_SSA_SBPL_SED








.. GENERATED FROM PYTHON SOURCE LINES 25-53

Now, the :class:`~models.emission.synchrotron.Synchrotron_SSA_SBPL_SED` model produces a synchrotron SED
with the form:

.. math::

   F_{\nu} = F_{\nu,0}
   \left[
       \left( \frac{\nu}{\nu_{\rm break}} \right)^{\alpha_{\rm thick}/s}
       +
       \left( \frac{\nu}{\nu_{\rm break}} \right)^{\alpha_{\rm thin}/s}
   \right]^s,

where :math:`F_{\nu,0}` is the normalization at the break frequency
:math:`\nu_{\rm break}`. The spectral indices are tied to the electron energy
distribution power-law index :math:`p` via

.. math::

   \alpha_{\rm thick} = \frac{5}{2},
   \qquad
   \alpha_{\rm thin} = -\frac{p - 1}{2}.

This choice reproduces the canonical optically thick and optically thin synchrotron
spectral slopes expected for a homogeneous emitting region with a power-law electron
population.

In order to produce the synthetic data, we'll first define a set of model parameters and then forward model their
SED with a Gaussian noise with a standard deviation proportional to the flux density.

.. GENERATED FROM PYTHON SOURCE LINES 53-72

.. code-block:: Python


    # Generate the forward model object.
    sed_model = Synchrotron_SSA_SBPL_SED()

    # Create a parameter dictionary with our preferred true values.
    true_params = {"norm": 5.0 * u.mJy, "nu_break": 4.0 * u.GHz, "p": 3.0, "s": -1.0}

    # Define the noise level as a fraction of the flux density.
    noise_fraction = 0.1  # 5% noise

    # Generate the frequencies to use for the synthetic data.
    frequencies = u.Quantity([0.1, 0.5, 1.0, 3.0, 5.0, 7.0, 10.0, 15.0, 20.0, 30.0], u.GHz)

    # Generate the synthetic flux densities with noise.
    synthetic_flux = sed_model.forward_model({"frequency": frequencies}, true_params)["flux_density"]
    synthetic_flux += (
        np.random.normal(size=synthetic_flux.shape, scale=noise_fraction * synthetic_flux.to_value("mJy")) * u.mJy
    )








.. GENERATED FROM PYTHON SOURCE LINES 73-74

Let's go ahead and look at the plot of the true model and the synthetic data points.

.. GENERATED FROM PYTHON SOURCE LINES 74-101

.. code-block:: Python

    import matplotlib.pyplot as plt

    # Create a figure and axis for the plot.
    fig, ax = plt.subplots(figsize=(10, 6))

    # Plot the true model.
    freqs_plot = np.logspace(8, 11, 100) * u.Hz
    true_flux_plot = sed_model.forward_model({"frequency": freqs_plot}, true_params)["flux_density"]
    ax.plot(freqs_plot.to_value(u.GHz), true_flux_plot.to_value(u.mJy), label="True Model", color="black")

    # Add our synthetic data points.
    ax.errorbar(
        frequencies.to_value(u.GHz),
        synthetic_flux.to_value(u.mJy),
        yerr=noise_fraction * synthetic_flux.to_value(u.mJy),
        fmt="o",
        label="Synthetic Data",
        color="red",
    )

    ax.set_xlabel("Frequency [Hz]")
    ax.set_ylabel("Flux Density [mJy]")
    ax.set_xscale("log")
    ax.set_yscale("log")

    plt.show()




.. image-sg:: /auto_examples/b_inference/images/sphx_glr_plot_SED_fit_001.png
   :alt: plot SED fit
   :srcset: /auto_examples/b_inference/images/sphx_glr_plot_SED_fit_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 102-109

Inference
---------
Now that we have our synthetic dataset, we can set up the inference to recover the original parameters.
We'll use MCMC for this purpose, which requires us to define a likelihood function and priors for the parameters.

To start, we'll need to create a data container object to hold our synthetic data. We'll use
a :class:`~astropy.table.Table` object and then feed it into the :class:`~data.photometry.RadioPhotometryContainer`.

.. GENERATED FROM PYTHON SOURCE LINES 109-125

.. code-block:: Python

    from astropy.table import Table

    from triceratops.data.photometry import RadioPhotometryContainer

    # Create an Astropy Table with the synthetic data. We'll have everything happen at the same
    # epoch in this case (dummy time column), and we'll set the upper limits to NaN since we have detections.
    data_table = Table()
    data_table["freq"] = frequencies
    data_table["flux_density"] = synthetic_flux
    data_table["flux_density_error"] = noise_fraction * synthetic_flux
    data_table["flux_upper_limit"] = np.full((frequencies.size,), np.nan) * u.mJy  # No upper limits
    data_table["time"] = np.zeros((frequencies.size,)) * u.day  # Dummy time column

    # Create the RadioPhotometryContainer from the table.
    photometry_data = RadioPhotometryContainer(data_table)








.. GENERATED FROM PYTHON SOURCE LINES 126-130

Now that we have the data container, we can set up the likelihood function. We'll use the
:class:`inference.likelihood.single_epoch_photometry.GaussianPhotometryLikelihood` for this purpose.

This likelihood works with single-epoch photometry data and assumes Gaussian errors on the flux densities.

.. GENERATED FROM PYTHON SOURCE LINES 130-144

.. code-block:: Python

    from triceratops.inference.likelihood.single_epoch_photometry import (
        GaussianPhotometryLikelihood,
    )

    # Create the likelihood object.
    likelihood = GaussianPhotometryLikelihood(
        model=sed_model,
        data=photometry_data,
    )

    # Print the current log likelihood value for the true parameters.
    log_likelihood_true = likelihood.log_likelihood(true_params)
    print(f"Log Likelihood at True Parameters: {log_likelihood_true}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Log Likelihood at True Parameters: 86.50764078898003




.. GENERATED FROM PYTHON SOURCE LINES 145-147

Next, we need to define priors for the parameters we want to infer and generate an
inference problem (:class:`inference.problem.InferenceProblem`). We'll use uniform priors for simplicity.

.. GENERATED FROM PYTHON SOURCE LINES 147-169

.. code-block:: Python

    from triceratops.inference.prior import UniformPrior
    from triceratops.inference.problem import InferenceProblem
    from triceratops.inference.sampling.mcmc import EmceeSampler

    # Generate the inference problem
    problem = InferenceProblem(
        likelihood=likelihood,
    )

    # Set the priors for the parameters.
    problem.parameters["norm"].prior = UniformPrior(lower=1e-3, upper=200.0)  # in Jy
    problem.parameters["nu_break"].prior = UniformPrior(lower=1.0, upper=50.0)  # in GHz
    problem.parameters["p"].prior = UniformPrior(lower=2.0, upper=5.0)
    problem.parameters["s"].prior = UniformPrior(lower=-5.0, upper=-0.5)

    # Create the sampler.
    sampler = EmceeSampler(problem, n_walkers=32, ensemble_kwargs=dict())

    # Run MCMC
    result = sampler.run(10_000, progress=True)
    samples = result.get_flat_samples(burn=1000, thin=10)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/10000 [00:00<?, ?it/s]/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/emcee/moves/red_blue.py:99: RuntimeWarning: invalid value encountered in scalar subtract
      lnpdiff = f + nlp - state.log_prob[j]
      0%|          | 40/10000 [00:00<00:25, 394.89it/s]      1%|          | 80/10000 [00:00<00:25, 387.81it/s]      1%|          | 119/10000 [00:00<00:26, 377.27it/s]      2%|▏         | 157/10000 [00:00<00:26, 370.83it/s]      2%|▏         | 195/10000 [00:00<00:26, 364.53it/s]      2%|▏         | 232/10000 [00:00<00:26, 364.96it/s]      3%|▎         | 269/10000 [00:00<00:26, 364.82it/s]      3%|▎         | 306/10000 [00:00<00:26, 365.30it/s]      3%|▎         | 343/10000 [00:00<00:26, 365.91it/s]      4%|▍         | 381/10000 [00:01<00:26, 368.00it/s]      4%|▍         | 419/10000 [00:01<00:25, 369.03it/s]      5%|▍         | 456/10000 [00:01<00:25, 367.71it/s]      5%|▍         | 493/10000 [00:01<00:25, 365.86it/s]      5%|▌         | 530/10000 [00:01<00:25, 365.79it/s]      6%|▌         | 568/10000 [00:01<00:25, 367.91it/s]      6%|▌         | 605/10000 [00:01<00:25, 368.11it/s]      6%|▋         | 642/10000 [00:01<00:25, 365.10it/s]      7%|▋         | 679/10000 [00:01<00:25, 365.55it/s]      7%|▋         | 716/10000 [00:01<00:25, 365.43it/s]      8%|▊         | 753/10000 [00:02<00:25, 366.55it/s]      8%|▊         | 790/10000 [00:02<00:25, 367.08it/s]      8%|▊         | 827/10000 [00:02<00:25, 366.89it/s]      9%|▊         | 864/10000 [00:02<00:25, 363.22it/s]      9%|▉         | 901/10000 [00:02<00:25, 361.14it/s]      9%|▉         | 938/10000 [00:02<00:25, 357.68it/s]     10%|▉         | 974/10000 [00:02<00:25, 356.84it/s]     10%|█         | 1010/10000 [00:02<00:25, 357.61it/s]     10%|█         | 1047/10000 [00:02<00:24, 360.82it/s]     11%|█         | 1084/10000 [00:02<00:24, 362.65it/s]     11%|█         | 1121/10000 [00:03<00:24, 364.27it/s]     12%|█▏        | 1159/10000 [00:03<00:24, 366.46it/s]     12%|█▏        | 1196/10000 [00:03<00:24, 365.59it/s]     12%|█▏        | 1233/10000 [00:03<00:23, 365.82it/s]     13%|█▎        | 1270/10000 [00:03<00:23, 365.56it/s]     13%|█▎        | 1307/10000 [00:03<00:23, 363.21it/s]     13%|█▎        | 1344/10000 [00:03<00:24, 354.27it/s]     14%|█▍        | 1382/10000 [00:03<00:23, 359.41it/s]     14%|█▍        | 1419/10000 [00:03<00:23, 361.60it/s]     15%|█▍        | 1457/10000 [00:03<00:23, 364.70it/s]     15%|█▍        | 1495/10000 [00:04<00:23, 366.73it/s]     15%|█▌        | 1532/10000 [00:04<00:23, 366.74it/s]     16%|█▌        | 1569/10000 [00:04<00:23, 364.38it/s]     16%|█▌        | 1606/10000 [00:04<00:22, 365.51it/s]     16%|█▋        | 1643/10000 [00:04<00:22, 366.67it/s]     17%|█▋        | 1680/10000 [00:04<00:22, 367.03it/s]     17%|█▋        | 1717/10000 [00:04<00:22, 367.48it/s]     18%|█▊        | 1755/10000 [00:04<00:22, 370.08it/s]     18%|█▊        | 1793/10000 [00:04<00:22, 371.02it/s]     18%|█▊        | 1831/10000 [00:05<00:22, 370.59it/s]     19%|█▊        | 1869/10000 [00:05<00:21, 370.83it/s]     19%|█▉        | 1907/10000 [00:05<00:21, 370.12it/s]     19%|█▉        | 1945/10000 [00:05<00:21, 368.32it/s]     20%|█▉        | 1982/10000 [00:05<00:21, 367.37it/s]     20%|██        | 2019/10000 [00:05<00:21, 363.93it/s]     21%|██        | 2056/10000 [00:05<00:21, 363.41it/s]     21%|██        | 2093/10000 [00:05<00:21, 365.26it/s]     21%|██▏       | 2130/10000 [00:05<00:21, 365.35it/s]     22%|██▏       | 2167/10000 [00:05<00:21, 364.25it/s]     22%|██▏       | 2204/10000 [00:06<00:21, 363.80it/s]     22%|██▏       | 2241/10000 [00:06<00:21, 363.79it/s]     23%|██▎       | 2278/10000 [00:06<00:21, 364.28it/s]     23%|██▎       | 2315/10000 [00:06<00:21, 362.19it/s]     24%|██▎       | 2352/10000 [00:06<00:21, 363.41it/s]     24%|██▍       | 2389/10000 [00:06<00:20, 364.73it/s]     24%|██▍       | 2426/10000 [00:06<00:20, 366.19it/s]     25%|██▍       | 2464/10000 [00:06<00:20, 367.39it/s]     25%|██▌       | 2502/10000 [00:06<00:20, 368.96it/s]     25%|██▌       | 2539/10000 [00:06<00:20, 368.17it/s]     26%|██▌       | 2577/10000 [00:07<00:20, 368.56it/s]     26%|██▌       | 2615/10000 [00:07<00:20, 369.10it/s]     27%|██▋       | 2653/10000 [00:07<00:19, 369.60it/s]     27%|██▋       | 2690/10000 [00:07<00:19, 366.57it/s]     27%|██▋       | 2728/10000 [00:07<00:19, 367.67it/s]     28%|██▊       | 2765/10000 [00:07<00:19, 367.03it/s]     28%|██▊       | 2803/10000 [00:07<00:19, 368.22it/s]     28%|██▊       | 2840/10000 [00:07<00:20, 342.08it/s]     29%|██▉       | 2875/10000 [00:07<00:20, 342.32it/s]     29%|██▉       | 2912/10000 [00:07<00:20, 348.56it/s]     29%|██▉       | 2949/10000 [00:08<00:19, 353.36it/s]     30%|██▉       | 2986/10000 [00:08<00:19, 356.53it/s]     30%|███       | 3023/10000 [00:08<00:19, 358.65it/s]     31%|███       | 3060/10000 [00:08<00:19, 359.70it/s]     31%|███       | 3097/10000 [00:08<00:19, 362.37it/s]     31%|███▏      | 3134/10000 [00:08<00:18, 362.91it/s]     32%|███▏      | 3171/10000 [00:08<00:18, 362.96it/s]     32%|███▏      | 3208/10000 [00:08<00:18, 363.35it/s]     32%|███▏      | 3245/10000 [00:08<00:18, 363.01it/s]     33%|███▎      | 3282/10000 [00:09<00:18, 363.46it/s]     33%|███▎      | 3319/10000 [00:09<00:18, 363.15it/s]     34%|███▎      | 3356/10000 [00:09<00:18, 363.66it/s]     34%|███▍      | 3393/10000 [00:09<00:18, 364.50it/s]     34%|███▍      | 3430/10000 [00:09<00:17, 365.54it/s]     35%|███▍      | 3467/10000 [00:09<00:17, 365.46it/s]     35%|███▌      | 3504/10000 [00:09<00:17, 366.12it/s]     35%|███▌      | 3541/10000 [00:09<00:17, 365.27it/s]     36%|███▌      | 3578/10000 [00:09<00:17, 363.02it/s]     36%|███▌      | 3615/10000 [00:09<00:17, 362.78it/s]     37%|███▋      | 3652/10000 [00:10<00:17, 364.41it/s]     37%|███▋      | 3689/10000 [00:10<00:17, 364.42it/s]     37%|███▋      | 3726/10000 [00:10<00:17, 364.67it/s]     38%|███▊      | 3763/10000 [00:10<00:17, 361.41it/s]     38%|███▊      | 3800/10000 [00:10<00:17, 362.66it/s]     38%|███▊      | 3837/10000 [00:10<00:17, 360.81it/s]     39%|███▊      | 3874/10000 [00:10<00:17, 358.13it/s]     39%|███▉      | 3910/10000 [00:10<00:17, 351.62it/s]     39%|███▉      | 3948/10000 [00:10<00:16, 358.25it/s]     40%|███▉      | 3986/10000 [00:10<00:16, 364.55it/s]     40%|████      | 4023/10000 [00:11<00:16, 363.99it/s]     41%|████      | 4060/10000 [00:11<00:16, 365.72it/s]     41%|████      | 4097/10000 [00:11<00:16, 366.01it/s]     41%|████▏     | 4134/10000 [00:11<00:16, 365.52it/s]     42%|████▏     | 4171/10000 [00:11<00:15, 366.52it/s]     42%|████▏     | 4208/10000 [00:11<00:15, 365.84it/s]     42%|████▏     | 4245/10000 [00:11<00:15, 365.53it/s]     43%|████▎     | 4282/10000 [00:11<00:15, 364.64it/s]     43%|████▎     | 4319/10000 [00:11<00:15, 364.65it/s]     44%|████▎     | 4356/10000 [00:11<00:15, 365.40it/s]     44%|████▍     | 4394/10000 [00:12<00:15, 368.65it/s]     44%|████▍     | 4431/10000 [00:12<00:15, 368.99it/s]     45%|████▍     | 4470/10000 [00:12<00:14, 372.46it/s]     45%|████▌     | 4508/10000 [00:12<00:14, 371.64it/s]     45%|████▌     | 4546/10000 [00:12<00:14, 371.00it/s]     46%|████▌     | 4584/10000 [00:12<00:14, 369.30it/s]     46%|████▌     | 4622/10000 [00:12<00:14, 370.87it/s]     47%|████▋     | 4660/10000 [00:12<00:14, 370.22it/s]     47%|████▋     | 4698/10000 [00:12<00:14, 370.77it/s]     47%|████▋     | 4736/10000 [00:12<00:14, 370.08it/s]     48%|████▊     | 4774/10000 [00:13<00:14, 368.71it/s]     48%|████▊     | 4812/10000 [00:13<00:14, 370.28it/s]     48%|████▊     | 4850/10000 [00:13<00:13, 369.99it/s]     49%|████▉     | 4888/10000 [00:13<00:14, 344.42it/s]     49%|████▉     | 4925/10000 [00:13<00:14, 350.30it/s]     50%|████▉     | 4962/10000 [00:13<00:14, 355.50it/s]     50%|████▉     | 4999/10000 [00:13<00:13, 358.80it/s]     50%|█████     | 5036/10000 [00:13<00:13, 359.74it/s]     51%|█████     | 5074/10000 [00:13<00:13, 363.84it/s]     51%|█████     | 5111/10000 [00:14<00:13, 363.79it/s]     51%|█████▏    | 5148/10000 [00:14<00:13, 364.01it/s]     52%|█████▏    | 5185/10000 [00:14<00:13, 361.54it/s]     52%|█████▏    | 5222/10000 [00:14<00:13, 360.76it/s]     53%|█████▎    | 5259/10000 [00:14<00:13, 362.44it/s]     53%|█████▎    | 5296/10000 [00:14<00:12, 363.25it/s]     53%|█████▎    | 5333/10000 [00:14<00:12, 365.13it/s]     54%|█████▎    | 5370/10000 [00:14<00:12, 363.32it/s]     54%|█████▍    | 5407/10000 [00:14<00:12, 364.24it/s]     54%|█████▍    | 5445/10000 [00:14<00:12, 367.55it/s]     55%|█████▍    | 5483/10000 [00:15<00:12, 368.49it/s]     55%|█████▌    | 5520/10000 [00:15<00:12, 366.05it/s]     56%|█████▌    | 5557/10000 [00:15<00:12, 365.58it/s]     56%|█████▌    | 5594/10000 [00:15<00:12, 365.48it/s]     56%|█████▋    | 5631/10000 [00:15<00:11, 366.28it/s]     57%|█████▋    | 5668/10000 [00:15<00:11, 364.19it/s]     57%|█████▋    | 5705/10000 [00:15<00:11, 364.87it/s]     57%|█████▋    | 5742/10000 [00:15<00:11, 363.46it/s]     58%|█████▊    | 5780/10000 [00:15<00:11, 365.94it/s]     58%|█████▊    | 5817/10000 [00:15<00:11, 365.91it/s]     59%|█████▊    | 5854/10000 [00:16<00:11, 366.32it/s]     59%|█████▉    | 5892/10000 [00:16<00:11, 367.65it/s]     59%|█████▉    | 5930/10000 [00:16<00:11, 368.77it/s]     60%|█████▉    | 5967/10000 [00:16<00:10, 368.31it/s]     60%|██████    | 6005/10000 [00:16<00:10, 370.19it/s]     60%|██████    | 6043/10000 [00:16<00:10, 367.82it/s]     61%|██████    | 6080/10000 [00:16<00:10, 367.79it/s]     61%|██████    | 6117/10000 [00:16<00:10, 366.30it/s]     62%|██████▏   | 6155/10000 [00:16<00:10, 369.32it/s]     62%|██████▏   | 6192/10000 [00:16<00:10, 359.00it/s]     62%|██████▏   | 6229/10000 [00:17<00:10, 360.84it/s]     63%|██████▎   | 6266/10000 [00:17<00:10, 362.09it/s]     63%|██████▎   | 6303/10000 [00:17<00:10, 361.27it/s]     63%|██████▎   | 6340/10000 [00:17<00:10, 362.27it/s]     64%|██████▍   | 6377/10000 [00:17<00:09, 362.68it/s]     64%|██████▍   | 6414/10000 [00:17<00:09, 361.82it/s]     65%|██████▍   | 6451/10000 [00:17<00:09, 363.66it/s]     65%|██████▍   | 6489/10000 [00:17<00:09, 366.02it/s]     65%|██████▌   | 6527/10000 [00:17<00:09, 367.89it/s]     66%|██████▌   | 6565/10000 [00:18<00:09, 368.36it/s]     66%|██████▌   | 6604/10000 [00:18<00:09, 372.10it/s]     66%|██████▋   | 6642/10000 [00:18<00:09, 372.23it/s]     67%|██████▋   | 6680/10000 [00:18<00:09, 366.96it/s]     67%|██████▋   | 6717/10000 [00:18<00:09, 363.59it/s]     68%|██████▊   | 6754/10000 [00:18<00:09, 357.73it/s]     68%|██████▊   | 6791/10000 [00:18<00:08, 358.93it/s]     68%|██████▊   | 6828/10000 [00:18<00:08, 361.43it/s]     69%|██████▊   | 6865/10000 [00:18<00:08, 363.20it/s]     69%|██████▉   | 6902/10000 [00:18<00:08, 362.46it/s]     69%|██████▉   | 6939/10000 [00:19<00:08, 342.22it/s]     70%|██████▉   | 6977/10000 [00:19<00:08, 350.89it/s]     70%|███████   | 7014/10000 [00:19<00:08, 355.26it/s]     71%|███████   | 7051/10000 [00:19<00:08, 358.38it/s]     71%|███████   | 7088/10000 [00:19<00:08, 359.80it/s]     71%|███████▏  | 7125/10000 [00:19<00:07, 360.83it/s]     72%|███████▏  | 7162/10000 [00:19<00:07, 361.22it/s]     72%|███████▏  | 7199/10000 [00:19<00:07, 361.82it/s]     72%|███████▏  | 7236/10000 [00:19<00:07, 362.65it/s]     73%|███████▎  | 7273/10000 [00:19<00:07, 361.11it/s]     73%|███████▎  | 7310/10000 [00:20<00:07, 362.12it/s]     73%|███████▎  | 7347/10000 [00:20<00:07, 363.23it/s]     74%|███████▍  | 7384/10000 [00:20<00:07, 361.71it/s]     74%|███████▍  | 7421/10000 [00:20<00:07, 360.98it/s]     75%|███████▍  | 7458/10000 [00:20<00:07, 361.96it/s]     75%|███████▍  | 7495/10000 [00:20<00:06, 363.31it/s]     75%|███████▌  | 7532/10000 [00:20<00:06, 363.58it/s]     76%|███████▌  | 7570/10000 [00:20<00:06, 366.01it/s]     76%|███████▌  | 7608/10000 [00:20<00:06, 367.49it/s]     76%|███████▋  | 7645/10000 [00:20<00:06, 367.72it/s]     77%|███████▋  | 7682/10000 [00:21<00:06, 366.28it/s]     77%|███████▋  | 7719/10000 [00:21<00:06, 364.04it/s]     78%|███████▊  | 7756/10000 [00:21<00:06, 364.19it/s]     78%|███████▊  | 7793/10000 [00:21<00:06, 363.36it/s]     78%|███████▊  | 7830/10000 [00:21<00:05, 363.66it/s]     79%|███████▊  | 7867/10000 [00:21<00:05, 364.72it/s]     79%|███████▉  | 7904/10000 [00:21<00:05, 365.21it/s]     79%|███████▉  | 7941/10000 [00:21<00:05, 366.11it/s]     80%|███████▉  | 7979/10000 [00:21<00:05, 369.29it/s]     80%|████████  | 8016/10000 [00:22<00:05, 369.19it/s]     81%|████████  | 8053/10000 [00:22<00:05, 366.02it/s]     81%|████████  | 8090/10000 [00:22<00:05, 366.53it/s]     81%|████████▏ | 8127/10000 [00:22<00:05, 365.61it/s]     82%|████████▏ | 8164/10000 [00:22<00:05, 366.64it/s]     82%|████████▏ | 8201/10000 [00:22<00:04, 364.87it/s]     82%|████████▏ | 8238/10000 [00:22<00:04, 363.97it/s]     83%|████████▎ | 8275/10000 [00:22<00:04, 364.45it/s]     83%|████████▎ | 8312/10000 [00:22<00:04, 365.73it/s]     83%|████████▎ | 8349/10000 [00:22<00:04, 365.27it/s]     84%|████████▍ | 8386/10000 [00:23<00:04, 365.76it/s]     84%|████████▍ | 8423/10000 [00:23<00:04, 365.10it/s]     85%|████████▍ | 8461/10000 [00:23<00:04, 367.24it/s]     85%|████████▍ | 8498/10000 [00:23<00:04, 366.44it/s]     85%|████████▌ | 8535/10000 [00:23<00:03, 366.81it/s]     86%|████████▌ | 8572/10000 [00:23<00:03, 363.94it/s]     86%|████████▌ | 8609/10000 [00:23<00:03, 364.83it/s]     86%|████████▋ | 8647/10000 [00:23<00:03, 366.52it/s]     87%|████████▋ | 8684/10000 [00:23<00:03, 365.47it/s]     87%|████████▋ | 8721/10000 [00:23<00:03, 366.48it/s]     88%|████████▊ | 8758/10000 [00:24<00:03, 364.08it/s]     88%|████████▊ | 8795/10000 [00:24<00:03, 365.61it/s]     88%|████████▊ | 8832/10000 [00:24<00:03, 362.85it/s]     89%|████████▊ | 8869/10000 [00:24<00:03, 364.06it/s]     89%|████████▉ | 8906/10000 [00:24<00:02, 365.73it/s]     89%|████████▉ | 8943/10000 [00:24<00:02, 364.19it/s]     90%|████████▉ | 8980/10000 [00:24<00:02, 363.98it/s]     90%|█████████ | 9017/10000 [00:24<00:02, 363.74it/s]     91%|█████████ | 9054/10000 [00:24<00:02, 365.02it/s]     91%|█████████ | 9091/10000 [00:24<00:02, 366.42it/s]     91%|█████████▏| 9128/10000 [00:25<00:02, 367.36it/s]     92%|█████████▏| 9165/10000 [00:25<00:02, 367.22it/s]     92%|█████████▏| 9202/10000 [00:25<00:02, 366.39it/s]     92%|█████████▏| 9239/10000 [00:25<00:02, 363.53it/s]     93%|█████████▎| 9276/10000 [00:25<00:01, 362.40it/s]     93%|█████████▎| 9313/10000 [00:25<00:01, 364.51it/s]     94%|█████████▎| 9350/10000 [00:25<00:01, 365.19it/s]     94%|█████████▍| 9388/10000 [00:25<00:01, 366.85it/s]     94%|█████████▍| 9427/10000 [00:25<00:01, 370.95it/s]     95%|█████████▍| 9465/10000 [00:25<00:01, 371.87it/s]     95%|█████████▌| 9503/10000 [00:26<00:01, 370.24it/s]     95%|█████████▌| 9541/10000 [00:26<00:01, 371.49it/s]     96%|█████████▌| 9579/10000 [00:26<00:01, 369.32it/s]     96%|█████████▌| 9616/10000 [00:26<00:01, 368.82it/s]     97%|█████████▋| 9653/10000 [00:26<00:00, 368.62it/s]     97%|█████████▋| 9690/10000 [00:26<00:00, 367.13it/s]     97%|█████████▋| 9727/10000 [00:26<00:00, 367.21it/s]     98%|█████████▊| 9765/10000 [00:26<00:00, 368.54it/s]     98%|█████████▊| 9802/10000 [00:26<00:00, 368.06it/s]     98%|█████████▊| 9840/10000 [00:26<00:00, 369.08it/s]     99%|█████████▉| 9878/10000 [00:27<00:00, 369.89it/s]     99%|█████████▉| 9915/10000 [00:27<00:00, 368.23it/s]    100%|█████████▉| 9952/10000 [00:27<00:00, 363.19it/s]    100%|█████████▉| 9989/10000 [00:27<00:00, 361.02it/s]    100%|██████████| 10000/10000 [00:27<00:00, 364.58it/s]




.. GENERATED FROM PYTHON SOURCE LINES 170-172

Finally, we can analyze the MCMC results to see how well we recovered the original parameters.
Frequencies for plotting

.. GENERATED FROM PYTHON SOURCE LINES 172-210

.. code-block:: Python

    freqs_plot = np.logspace(8, 11, 200) * u.Hz

    fig, ax = plt.subplots(figsize=(10, 6))

    # Plot data
    ax.errorbar(
        frequencies.to_value(u.GHz),
        synthetic_flux.to_value(u.mJy),
        yerr=noise_fraction * synthetic_flux.to_value(u.mJy),
        fmt="o",
        color="red",
        label="Data",
    )

    # Draw a subset of posterior samples
    n_draw = 100
    idx = np.random.choice(samples.shape[0], n_draw, replace=False)

    for i in idx:
        theta_free = samples[i]
        params = problem.unpack_free_parameters(theta_free)
        flux = sed_model.forward_model({"frequency": freqs_plot}, params)["flux_density"]

        ax.plot(freqs_plot.to_value(u.GHz), flux.to_value(u.mJy), color="C0", alpha=0.05)

    # Plot true model
    true_flux_plot = sed_model.forward_model({"frequency": freqs_plot}, true_params)["flux_density"]

    ax.plot(freqs_plot.to_value(u.GHz), true_flux_plot.to_value(u.mJy), color="black", lw=2, label="True Model")

    ax.set_xscale("log")
    ax.set_yscale("log")
    ax.set_xlabel("Frequency [GHz]")
    ax.set_ylabel("Flux Density [mJy]")
    ax.legend()

    plt.show()




.. image-sg:: /auto_examples/b_inference/images/sphx_glr_plot_SED_fit_002.png
   :alt: plot SED fit
   :srcset: /auto_examples/b_inference/images/sphx_glr_plot_SED_fit_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 211-216

It's also always good practice to look at some diagnostic plots to ensure that the MCMC
chains have converged and that the posterior distributions look reasonable. We'll use the built-in plotting utilities
in Triceratops for this.

Let's start by looking at the trace plots for the :math:`\nu_{\rm brk}` parameter.

.. GENERATED FROM PYTHON SOURCE LINES 216-219

.. code-block:: Python

    fig, ax = result.trace_plot("nu_break", burn=1000, thin=5)
    plt.show()




.. image-sg:: /auto_examples/b_inference/images/sphx_glr_plot_SED_fit_003.png
   :alt: Trace plot: nu_break
   :srcset: /auto_examples/b_inference/images/sphx_glr_plot_SED_fit_003.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 220-221

Let's also look at the corner plot for all the parameters to see their posterior distributions and covariances.

.. GENERATED FROM PYTHON SOURCE LINES 221-223

.. code-block:: Python

    fig = result.corner_plot(burn=1000, thin=5)
    plt.show()



.. image-sg:: /auto_examples/b_inference/images/sphx_glr_plot_SED_fit_004.png
   :alt: norm = ${0.00381}_{-0.000337}^{+0.000421}$, nu_break = ${3.57}_{-0.147}^{+0.158}$, p = ${2.53}_{-0.162}^{+0.187}$, s = ${-0.69}_{-0.194}^{+0.128}$
   :srcset: /auto_examples/b_inference/images/sphx_glr_plot_SED_fit_004.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 29.085 seconds)


.. _sphx_glr_download_auto_examples_b_inference_plot_SED_fit.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_SED_fit.ipynb <plot_SED_fit.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_SED_fit.py <plot_SED_fit.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_SED_fit.zip <plot_SED_fit.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
