
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/b_inference/plot_censored_SED_fit.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_b_inference_plot_censored_SED_fit.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_b_inference_plot_censored_SED_fit.py:


=======================================
Fit Censored Radio Photometry to a BPL
=======================================

In this example, we'll do consider the relatively simple task of fitting a single epoch of
censored radio photometry data using a broken power-law (BPL) model. This is an excellent
example of the robust data handling and likelihood construction of the Triceratops library.

We'll use the :class:`~models.emission.synchrotron.Synchrotron_SSA_SBPL_SED` model to generate some synthetic
data with a fixed noise threshold and then we'll invert that data to recover the original parameters using MCMC.
This will take us through the basic steps of generating the model, defining the dataset, setting up the likelihood,
and running the inference with correct priors.

.. GENERATED FROM PYTHON SOURCE LINES 15-19

.. code-block:: Python


    import numpy as np
    from astropy import units as u








.. GENERATED FROM PYTHON SOURCE LINES 20-23

Setup
-----
First, we need to import the necessary libraries

.. GENERATED FROM PYTHON SOURCE LINES 23-25

.. code-block:: Python

    from triceratops.models.emission.synchrotron import Synchrotron_SSA_SBPL_SED








.. GENERATED FROM PYTHON SOURCE LINES 26-54

Now, the :class:`~models.emission.synchrotron.Synchrotron_SSA_SBPL_SED` model produces a synchrotron SED
with the form:

.. math::

   F_{\nu} = F_{\nu,0}
   \left[
       \left( \frac{\nu}{\nu_{\rm break}} \right)^{\alpha_{\rm thick}/s}
       +
       \left( \frac{\nu}{\nu_{\rm break}} \right)^{\alpha_{\rm thin}/s}
   \right]^s,

where :math:`F_{\nu,0}` is the normalization at the break frequency
:math:`\nu_{\rm break}`. The spectral indices are tied to the electron energy
distribution power-law index :math:`p` via

.. math::

   \alpha_{\rm thick} = \frac{5}{2},
   \qquad
   \alpha_{\rm thin} = -\frac{p - 1}{2}.

This choice reproduces the canonical optically thick and optically thin synchrotron
spectral slopes expected for a homogeneous emitting region with a power-law electron
population.

In order to produce the synthetic data, we'll first define a set of model parameters and then forward model their
SED with a Gaussian noise with a standard deviation proportional to the flux density.

.. GENERATED FROM PYTHON SOURCE LINES 54-82

.. code-block:: Python


    # Generate the forward model object.
    sed_model = Synchrotron_SSA_SBPL_SED()

    # Create a parameter dictionary with our preferred true values.
    true_params = {"norm": 5.0 * u.mJy, "nu_break": 4.0 * u.GHz, "p": 3.0, "s": -1.0}

    # Define the noise level as a fraction of the flux density.
    noise_fraction = 0.3  # 5% noise

    # Generate the frequencies to use for the synthetic data.
    frequencies = u.Quantity([0.1, 0.5, 1.0, 3.0, 5.0, 7.0, 10.0, 15.0, 20.0, 30.0], u.GHz)

    # Create the fake flux limit
    flux_floor = 0.5 * u.mJy

    # Generate the synthetic flux densities with noise.
    synthetic_flux = sed_model.forward_model({"frequency": frequencies}, true_params)["flux_density"]
    synthetic_flux += (
        np.random.normal(size=synthetic_flux.shape, scale=noise_fraction * synthetic_flux.to_value("mJy")) * u.mJy
    )

    # Apply the flux floor to create censored data
    synthetic_flux = np.where(synthetic_flux < flux_floor, flux_floor, synthetic_flux)

    # create masks for the censored data
    censored_mask = synthetic_flux <= flux_floor








.. GENERATED FROM PYTHON SOURCE LINES 83-84

Let's go ahead and look at the plot of the true model and the synthetic data points.

.. GENERATED FROM PYTHON SOURCE LINES 84-122

.. code-block:: Python

    import matplotlib.pyplot as plt

    # Create a figure and axis for the plot.
    fig, ax = plt.subplots(figsize=(10, 6))

    # Plot the true model.
    freqs_plot = np.logspace(8, 11, 100) * u.Hz
    true_flux_plot = sed_model.forward_model({"frequency": freqs_plot}, true_params)["flux_density"]
    ax.plot(freqs_plot.to_value(u.GHz), true_flux_plot.to_value(u.mJy), label="True Model", color="black")

    # Add our synthetic data points.
    ax.errorbar(
        frequencies[~censored_mask].to_value(u.GHz),
        synthetic_flux[~censored_mask].to_value(u.mJy),
        yerr=noise_fraction * synthetic_flux[~censored_mask].to_value(u.mJy),
        fmt="o",
        label="Synthetic Data",
        color="red",
    )
    # Add censored points
    ax.scatter(
        frequencies[censored_mask].to_value(u.GHz),
        synthetic_flux[censored_mask].to_value(u.mJy),
        marker="v",
        color="blue",
        label="Censored Data",
    )

    ax.axhline(flux_floor.to_value("mJy"), color="black", ls="--", label="Flux Limit")

    ax.set_xlabel("Frequency [Hz]")
    ax.set_ylabel("Flux Density [mJy]")
    ax.set_xscale("log")
    ax.set_yscale("log")
    ax.legend()

    plt.show()




.. image-sg:: /auto_examples/b_inference/images/sphx_glr_plot_censored_SED_fit_001.png
   :alt: plot censored SED fit
   :srcset: /auto_examples/b_inference/images/sphx_glr_plot_censored_SED_fit_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 123-135

Inference
---------
Now that we have our synthetic dataset, we can set up the inference to recover the original parameters.
We'll use MCMC for this purpose, which requires us to define a likelihood function and priors for the parameters.

To start, we'll need to create a data container object to hold our synthetic data. We'll use
a :class:`~astropy.table.Table` object and then feed it into the
:class:`~data.photometry.RadioPhotometryEpochContainer`.

Inside of the data container, we'll put our frequencies, flux densities, flux density errors, and upper limits. We'll
place the detections above our ``flux_floor`` and we'll set our upper limits to the cases where the flux density
plus noise would have fallen below that threshold.

.. GENERATED FROM PYTHON SOURCE LINES 135-156

.. code-block:: Python

    from astropy.table import Table

    from triceratops.data.photometry import RadioPhotometryEpochContainer

    # Create an Astropy Table with the synthetic data. We'll have everything happen at the same
    # epoch in this case (dummy time column), and we'll set the upper limits to NaN since we have detections.
    data_table = Table()
    data_table["freq"] = frequencies
    data_table["flux_density"] = synthetic_flux
    data_table["flux_density_error"] = noise_fraction * synthetic_flux
    data_table["flux_upper_limit"] = np.full((frequencies.size,), np.nan) * u.mJy  # No upper limits

    # Swap in upper limits where appropriate
    data_table["flux_upper_limit"][censored_mask] = synthetic_flux[censored_mask]
    data_table["flux_density"][censored_mask] = np.nan * u.mJy
    data_table["flux_density_error"][censored_mask] = flux_floor / 3  # dummy error for censored points


    # Create the RadioPhotometryContainer from the table.
    photometry_data = RadioPhotometryEpochContainer(data_table)








.. GENERATED FROM PYTHON SOURCE LINES 157-161

Now that we have the data container, we can set up the likelihood function. We'll use the
:class:`inference.likelihood.base.GaussianLikelihoodXY` for this purpose.

This likelihood works with single-epoch photometry data and assumes Gaussian errors on the flux densities.

.. GENERATED FROM PYTHON SOURCE LINES 161-173

.. code-block:: Python

    from triceratops.inference.likelihood.base import GaussianLikelihoodXY

    # Create the likelihood object.
    likelihood = GaussianLikelihoodXY(
        model=sed_model,
        data=photometry_data,
    )

    # Print the current log likelihood value for the true parameters.
    log_likelihood_true = likelihood.log_likelihood(true_params)
    print(f"Log Likelihood at True Parameters: {log_likelihood_true}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Log Likelihood at True Parameters: 44.00503681284313




.. GENERATED FROM PYTHON SOURCE LINES 174-176

Next, we need to define priors for the parameters we want to infer and generate an
inference problem (:class:`inference.problem.InferenceProblem`). We'll use uniform priors for simplicity.

.. GENERATED FROM PYTHON SOURCE LINES 176-201

.. code-block:: Python

    from triceratops.inference.prior import UniformPrior
    from triceratops.inference.problem import InferenceProblem
    from triceratops.inference.sampling.mcmc import EmceeSampler

    # Generate the inference problem
    problem = InferenceProblem(
        likelihood=likelihood,
    )

    # Set the priors for the parameters.
    problem.set_prior("norm", "uniform", lower=1e-3 * u.Jy, upper=10.0 * u.Jy)
    problem.set_prior("nu_break", "uniform", lower=1 * u.GHz, upper=50 * u.GHz)
    problem.set_prior("p", "uniform", lower=2.0, upper=5.0)

    # Fix the 's' parameter since we don't want to infer it in this example.
    problem.parameters["s"].initial_value = true_params["s"]
    problem.parameters["s"].freeze = True

    # Create the sampler.
    sampler = EmceeSampler(problem, n_walkers=32, ensemble_kwargs=dict())

    # Run MCMC
    result = sampler.run(10_000, progress=True)
    samples = result.get_flat_samples(burn=1000, thin=10)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/10000 [00:00<?, ?it/s]      0%|          | 25/10000 [00:00<00:40, 249.15it/s]      1%|          | 53/10000 [00:00<00:37, 266.85it/s]      1%|          | 83/10000 [00:00<00:35, 278.56it/s]      1%|          | 111/10000 [00:00<00:35, 277.59it/s]      1%|▏         | 139/10000 [00:00<00:35, 274.43it/s]      2%|▏         | 167/10000 [00:00<00:36, 272.40it/s]      2%|▏         | 195/10000 [00:00<00:36, 270.22it/s]      2%|▏         | 223/10000 [00:00<00:35, 272.44it/s]      3%|▎         | 251/10000 [00:00<00:35, 273.39it/s]      3%|▎         | 279/10000 [00:01<00:35, 272.30it/s]      3%|▎         | 307/10000 [00:01<00:35, 271.70it/s]      3%|▎         | 335/10000 [00:01<00:35, 271.28it/s]      4%|▎         | 363/10000 [00:01<00:35, 271.59it/s]      4%|▍         | 391/10000 [00:01<00:35, 270.16it/s]      4%|▍         | 419/10000 [00:01<00:35, 268.60it/s]      4%|▍         | 447/10000 [00:01<00:35, 270.45it/s]      5%|▍         | 475/10000 [00:01<00:35, 271.48it/s]      5%|▌         | 503/10000 [00:01<00:34, 272.30it/s]      5%|▌         | 531/10000 [00:01<00:34, 270.89it/s]      6%|▌         | 559/10000 [00:02<00:34, 271.69it/s]      6%|▌         | 587/10000 [00:02<00:34, 270.88it/s]      6%|▌         | 615/10000 [00:02<00:34, 271.12it/s]      6%|▋         | 643/10000 [00:02<00:34, 269.65it/s]      7%|▋         | 671/10000 [00:02<00:34, 270.21it/s]      7%|▋         | 699/10000 [00:02<00:34, 272.35it/s]      7%|▋         | 727/10000 [00:02<00:34, 272.04it/s]      8%|▊         | 755/10000 [00:02<00:33, 272.48it/s]      8%|▊         | 783/10000 [00:02<00:33, 271.81it/s]      8%|▊         | 811/10000 [00:02<00:33, 271.43it/s]      8%|▊         | 839/10000 [00:03<00:33, 272.53it/s]      9%|▊         | 867/10000 [00:03<00:33, 273.21it/s]      9%|▉         | 895/10000 [00:03<00:33, 272.42it/s]      9%|▉         | 923/10000 [00:03<00:34, 266.10it/s]     10%|▉         | 951/10000 [00:03<00:33, 267.59it/s]     10%|▉         | 979/10000 [00:03<00:33, 268.22it/s]     10%|█         | 1006/10000 [00:03<00:33, 268.33it/s]     10%|█         | 1033/10000 [00:03<00:33, 268.55it/s]     11%|█         | 1060/10000 [00:03<00:33, 265.00it/s]     11%|█         | 1087/10000 [00:04<00:35, 248.02it/s]     11%|█         | 1114/10000 [00:04<00:35, 252.55it/s]     11%|█▏        | 1142/10000 [00:04<00:34, 258.19it/s]     12%|█▏        | 1170/10000 [00:04<00:33, 262.78it/s]     12%|█▏        | 1197/10000 [00:04<00:33, 264.10it/s]     12%|█▏        | 1224/10000 [00:04<00:33, 265.38it/s]     13%|█▎        | 1251/10000 [00:04<00:32, 266.30it/s]     13%|█▎        | 1278/10000 [00:04<00:32, 267.24it/s]     13%|█▎        | 1305/10000 [00:04<00:32, 267.64it/s]     13%|█▎        | 1332/10000 [00:04<00:32, 268.27it/s]     14%|█▎        | 1360/10000 [00:05<00:32, 269.96it/s]     14%|█▍        | 1388/10000 [00:05<00:31, 269.98it/s]     14%|█▍        | 1416/10000 [00:05<00:31, 271.21it/s]     14%|█▍        | 1444/10000 [00:05<00:31, 271.59it/s]     15%|█▍        | 1472/10000 [00:05<00:31, 271.64it/s]     15%|█▌        | 1500/10000 [00:05<00:31, 272.57it/s]     15%|█▌        | 1528/10000 [00:05<00:30, 273.62it/s]     16%|█▌        | 1556/10000 [00:05<00:30, 272.88it/s]     16%|█▌        | 1584/10000 [00:05<00:30, 273.49it/s]     16%|█▌        | 1612/10000 [00:05<00:30, 274.80it/s]     16%|█▋        | 1640/10000 [00:06<00:30, 275.12it/s]     17%|█▋        | 1668/10000 [00:06<00:30, 275.21it/s]     17%|█▋        | 1696/10000 [00:06<00:30, 275.24it/s]     17%|█▋        | 1724/10000 [00:06<00:30, 275.30it/s]     18%|█▊        | 1752/10000 [00:06<00:30, 274.38it/s]     18%|█▊        | 1780/10000 [00:06<00:30, 272.68it/s]     18%|█▊        | 1808/10000 [00:06<00:30, 271.15it/s]     18%|█▊        | 1836/10000 [00:06<00:30, 266.30it/s]     19%|█▊        | 1863/10000 [00:06<00:30, 265.62it/s]     19%|█▉        | 1891/10000 [00:07<00:30, 269.11it/s]     19%|█▉        | 1919/10000 [00:07<00:29, 269.66it/s]     19%|█▉        | 1947/10000 [00:07<00:29, 270.07it/s]     20%|█▉        | 1975/10000 [00:07<00:29, 269.74it/s]     20%|██        | 2003/10000 [00:07<00:29, 270.50it/s]     20%|██        | 2031/10000 [00:07<00:29, 270.27it/s]     21%|██        | 2060/10000 [00:07<00:29, 273.73it/s]     21%|██        | 2088/10000 [00:07<00:28, 274.34it/s]     21%|██        | 2116/10000 [00:07<00:28, 274.88it/s]     21%|██▏       | 2144/10000 [00:07<00:28, 274.59it/s]     22%|██▏       | 2172/10000 [00:08<00:28, 272.61it/s]     22%|██▏       | 2200/10000 [00:08<00:28, 272.23it/s]     22%|██▏       | 2228/10000 [00:08<00:28, 271.52it/s]     23%|██▎       | 2256/10000 [00:08<00:28, 270.60it/s]     23%|██▎       | 2284/10000 [00:08<00:28, 269.59it/s]     23%|██▎       | 2311/10000 [00:08<00:28, 266.86it/s]     23%|██▎       | 2339/10000 [00:08<00:28, 269.53it/s]     24%|██▎       | 2367/10000 [00:08<00:28, 270.08it/s]     24%|██▍       | 2395/10000 [00:08<00:28, 268.62it/s]     24%|██▍       | 2422/10000 [00:08<00:28, 268.64it/s]     24%|██▍       | 2449/10000 [00:09<00:28, 267.78it/s]     25%|██▍       | 2476/10000 [00:09<00:28, 268.35it/s]     25%|██▌       | 2504/10000 [00:09<00:27, 270.63it/s]     25%|██▌       | 2532/10000 [00:09<00:27, 270.58it/s]     26%|██▌       | 2560/10000 [00:09<00:27, 270.61it/s]     26%|██▌       | 2588/10000 [00:09<00:27, 269.19it/s]     26%|██▌       | 2615/10000 [00:09<00:27, 269.28it/s]     26%|██▋       | 2642/10000 [00:09<00:27, 267.80it/s]     27%|██▋       | 2669/10000 [00:09<00:27, 267.61it/s]     27%|██▋       | 2696/10000 [00:09<00:27, 267.82it/s]     27%|██▋       | 2723/10000 [00:10<00:27, 265.95it/s]     28%|██▊       | 2750/10000 [00:10<00:27, 266.29it/s]     28%|██▊       | 2777/10000 [00:10<00:27, 267.14it/s]     28%|██▊       | 2805/10000 [00:10<00:26, 268.07it/s]     28%|██▊       | 2833/10000 [00:10<00:26, 268.91it/s]     29%|██▊       | 2860/10000 [00:10<00:26, 269.00it/s]     29%|██▉       | 2887/10000 [00:10<00:26, 268.77it/s]     29%|██▉       | 2914/10000 [00:10<00:26, 268.87it/s]     29%|██▉       | 2941/10000 [00:10<00:26, 266.97it/s]     30%|██▉       | 2968/10000 [00:11<00:26, 266.74it/s]     30%|██▉       | 2996/10000 [00:11<00:26, 269.03it/s]     30%|███       | 3023/10000 [00:11<00:25, 269.25it/s]     30%|███       | 3050/10000 [00:11<00:25, 268.05it/s]     31%|███       | 3078/10000 [00:11<00:25, 268.74it/s]     31%|███       | 3105/10000 [00:11<00:25, 268.95it/s]     31%|███▏      | 3133/10000 [00:11<00:25, 272.06it/s]     32%|███▏      | 3161/10000 [00:11<00:25, 270.46it/s]     32%|███▏      | 3189/10000 [00:11<00:25, 268.68it/s]     32%|███▏      | 3216/10000 [00:11<00:25, 267.18it/s]     32%|███▏      | 3243/10000 [00:12<00:25, 267.70it/s]     33%|███▎      | 3270/10000 [00:12<00:25, 267.86it/s]     33%|███▎      | 3297/10000 [00:12<00:24, 268.48it/s]     33%|███▎      | 3325/10000 [00:12<00:24, 269.73it/s]     34%|███▎      | 3353/10000 [00:12<00:24, 271.94it/s]     34%|███▍      | 3381/10000 [00:12<00:24, 272.64it/s]     34%|███▍      | 3409/10000 [00:12<00:24, 272.12it/s]     34%|███▍      | 3437/10000 [00:12<00:24, 269.30it/s]     35%|███▍      | 3464/10000 [00:12<00:24, 269.44it/s]     35%|███▍      | 3492/10000 [00:12<00:24, 270.63it/s]     35%|███▌      | 3520/10000 [00:13<00:23, 270.43it/s]     35%|███▌      | 3548/10000 [00:13<00:23, 271.61it/s]     36%|███▌      | 3576/10000 [00:13<00:23, 270.10it/s]     36%|███▌      | 3604/10000 [00:13<00:23, 268.70it/s]     36%|███▋      | 3631/10000 [00:13<00:23, 266.56it/s]     37%|███▋      | 3658/10000 [00:13<00:23, 267.55it/s]     37%|███▋      | 3686/10000 [00:13<00:23, 269.92it/s]     37%|███▋      | 3714/10000 [00:13<00:23, 270.43it/s]     37%|███▋      | 3742/10000 [00:13<00:23, 269.51it/s]     38%|███▊      | 3769/10000 [00:13<00:23, 268.42it/s]     38%|███▊      | 3796/10000 [00:14<00:23, 268.36it/s]     38%|███▊      | 3824/10000 [00:14<00:22, 269.76it/s]     39%|███▊      | 3852/10000 [00:14<00:22, 271.36it/s]     39%|███▉      | 3881/10000 [00:14<00:22, 274.86it/s]     39%|███▉      | 3909/10000 [00:14<00:22, 275.29it/s]     39%|███▉      | 3937/10000 [00:14<00:22, 275.49it/s]     40%|███▉      | 3965/10000 [00:14<00:22, 274.10it/s]     40%|███▉      | 3993/10000 [00:14<00:21, 273.29it/s]     40%|████      | 4021/10000 [00:14<00:22, 271.74it/s]     40%|████      | 4049/10000 [00:15<00:21, 271.74it/s]     41%|████      | 4077/10000 [00:15<00:21, 271.50it/s]     41%|████      | 4105/10000 [00:15<00:21, 271.21it/s]     41%|████▏     | 4133/10000 [00:15<00:21, 270.53it/s]     42%|████▏     | 4161/10000 [00:15<00:21, 271.16it/s]     42%|████▏     | 4189/10000 [00:15<00:21, 270.34it/s]     42%|████▏     | 4217/10000 [00:15<00:21, 271.68it/s]     42%|████▏     | 4245/10000 [00:15<00:21, 267.50it/s]     43%|████▎     | 4273/10000 [00:15<00:21, 268.34it/s]     43%|████▎     | 4300/10000 [00:15<00:21, 267.51it/s]     43%|████▎     | 4327/10000 [00:16<00:21, 267.83it/s]     44%|████▎     | 4354/10000 [00:16<00:21, 268.46it/s]     44%|████▍     | 4382/10000 [00:16<00:20, 269.89it/s]     44%|████▍     | 4410/10000 [00:16<00:20, 271.21it/s]     44%|████▍     | 4438/10000 [00:16<00:20, 272.54it/s]     45%|████▍     | 4466/10000 [00:16<00:20, 272.05it/s]     45%|████▍     | 4494/10000 [00:16<00:20, 269.09it/s]     45%|████▌     | 4521/10000 [00:16<00:20, 268.98it/s]     45%|████▌     | 4548/10000 [00:16<00:20, 268.90it/s]     46%|████▌     | 4576/10000 [00:16<00:20, 269.65it/s]     46%|████▌     | 4604/10000 [00:17<00:19, 271.87it/s]     46%|████▋     | 4632/10000 [00:17<00:19, 270.35it/s]     47%|████▋     | 4660/10000 [00:17<00:19, 269.47it/s]     47%|████▋     | 4688/10000 [00:17<00:19, 269.97it/s]     47%|████▋     | 4716/10000 [00:17<00:19, 269.79it/s]     47%|████▋     | 4743/10000 [00:17<00:19, 269.30it/s]     48%|████▊     | 4771/10000 [00:17<00:19, 270.44it/s]     48%|████▊     | 4799/10000 [00:17<00:19, 271.56it/s]     48%|████▊     | 4827/10000 [00:17<00:19, 270.15it/s]     49%|████▊     | 4855/10000 [00:17<00:18, 271.69it/s]     49%|████▉     | 4883/10000 [00:18<00:18, 269.78it/s]     49%|████▉     | 4910/10000 [00:18<00:18, 269.53it/s]     49%|████▉     | 4938/10000 [00:18<00:18, 271.59it/s]     50%|████▉     | 4966/10000 [00:18<00:18, 273.18it/s]     50%|████▉     | 4994/10000 [00:18<00:18, 273.73it/s]     50%|█████     | 5022/10000 [00:18<00:18, 274.48it/s]     50%|█████     | 5050/10000 [00:18<00:18, 272.74it/s]     51%|█████     | 5078/10000 [00:18<00:18, 270.91it/s]     51%|█████     | 5106/10000 [00:18<00:18, 270.57it/s]     51%|█████▏    | 5134/10000 [00:19<00:18, 269.84it/s]     52%|█████▏    | 5161/10000 [00:19<00:17, 269.85it/s]     52%|█████▏    | 5188/10000 [00:19<00:17, 269.02it/s]     52%|█████▏    | 5215/10000 [00:19<00:17, 267.87it/s]     52%|█████▏    | 5243/10000 [00:19<00:17, 268.66it/s]     53%|█████▎    | 5271/10000 [00:19<00:17, 269.66it/s]     53%|█████▎    | 5299/10000 [00:19<00:17, 270.98it/s]     53%|█████▎    | 5327/10000 [00:19<00:17, 271.60it/s]     54%|█████▎    | 5355/10000 [00:19<00:17, 273.22it/s]     54%|█████▍    | 5383/10000 [00:19<00:16, 271.82it/s]     54%|█████▍    | 5411/10000 [00:20<00:16, 271.91it/s]     54%|█████▍    | 5440/10000 [00:20<00:16, 275.15it/s]     55%|█████▍    | 5468/10000 [00:20<00:16, 275.77it/s]     55%|█████▍    | 5496/10000 [00:20<00:16, 275.12it/s]     55%|█████▌    | 5524/10000 [00:20<00:16, 274.06it/s]     56%|█████▌    | 5552/10000 [00:20<00:16, 273.33it/s]     56%|█████▌    | 5580/10000 [00:20<00:16, 273.84it/s]     56%|█████▌    | 5608/10000 [00:20<00:16, 273.01it/s]     56%|█████▋    | 5636/10000 [00:20<00:16, 271.94it/s]     57%|█████▋    | 5664/10000 [00:20<00:15, 271.22it/s]     57%|█████▋    | 5692/10000 [00:21<00:15, 270.89it/s]     57%|█████▋    | 5720/10000 [00:21<00:15, 272.19it/s]     57%|█████▋    | 5748/10000 [00:21<00:15, 273.20it/s]     58%|█████▊    | 5776/10000 [00:21<00:15, 273.71it/s]     58%|█████▊    | 5805/10000 [00:21<00:15, 275.53it/s]     58%|█████▊    | 5833/10000 [00:21<00:15, 274.00it/s]     59%|█████▊    | 5861/10000 [00:21<00:15, 272.76it/s]     59%|█████▉    | 5889/10000 [00:21<00:15, 269.57it/s]     59%|█████▉    | 5916/10000 [00:21<00:15, 269.34it/s]     59%|█████▉    | 5943/10000 [00:21<00:15, 268.98it/s]     60%|█████▉    | 5970/10000 [00:22<00:15, 268.65it/s]     60%|█████▉    | 5998/10000 [00:22<00:14, 270.82it/s]     60%|██████    | 6026/10000 [00:22<00:14, 270.67it/s]     61%|██████    | 6054/10000 [00:22<00:14, 270.07it/s]     61%|██████    | 6082/10000 [00:22<00:14, 271.47it/s]     61%|██████    | 6110/10000 [00:22<00:14, 272.14it/s]     61%|██████▏   | 6138/10000 [00:22<00:14, 269.77it/s]     62%|██████▏   | 6165/10000 [00:22<00:14, 268.69it/s]     62%|██████▏   | 6193/10000 [00:22<00:14, 270.18it/s]     62%|██████▏   | 6221/10000 [00:23<00:14, 269.69it/s]     62%|██████▏   | 6248/10000 [00:23<00:13, 269.51it/s]     63%|██████▎   | 6275/10000 [00:23<00:13, 268.37it/s]     63%|██████▎   | 6302/10000 [00:23<00:13, 268.01it/s]     63%|██████▎   | 6330/10000 [00:23<00:13, 270.02it/s]     64%|██████▎   | 6358/10000 [00:23<00:13, 271.73it/s]     64%|██████▍   | 6386/10000 [00:23<00:13, 272.44it/s]     64%|██████▍   | 6414/10000 [00:23<00:13, 271.70it/s]     64%|██████▍   | 6442/10000 [00:23<00:13, 272.40it/s]     65%|██████▍   | 6470/10000 [00:23<00:12, 273.77it/s]     65%|██████▍   | 6498/10000 [00:24<00:12, 273.76it/s]     65%|██████▌   | 6526/10000 [00:24<00:12, 272.61it/s]     66%|██████▌   | 6554/10000 [00:24<00:12, 273.50it/s]     66%|██████▌   | 6582/10000 [00:24<00:12, 273.65it/s]     66%|██████▌   | 6610/10000 [00:24<00:12, 272.62it/s]     66%|██████▋   | 6638/10000 [00:24<00:12, 272.85it/s]     67%|██████▋   | 6666/10000 [00:24<00:12, 271.23it/s]     67%|██████▋   | 6694/10000 [00:24<00:12, 270.55it/s]     67%|██████▋   | 6722/10000 [00:24<00:12, 271.19it/s]     68%|██████▊   | 6750/10000 [00:24<00:12, 269.41it/s]     68%|██████▊   | 6778/10000 [00:25<00:11, 270.81it/s]     68%|██████▊   | 6806/10000 [00:25<00:11, 272.20it/s]     68%|██████▊   | 6834/10000 [00:25<00:11, 271.99it/s]     69%|██████▊   | 6862/10000 [00:25<00:11, 271.56it/s]     69%|██████▉   | 6890/10000 [00:25<00:11, 273.22it/s]     69%|██████▉   | 6918/10000 [00:25<00:11, 272.52it/s]     69%|██████▉   | 6946/10000 [00:25<00:11, 271.80it/s]     70%|██████▉   | 6974/10000 [00:25<00:11, 269.67it/s]     70%|███████   | 7002/10000 [00:25<00:11, 270.81it/s]     70%|███████   | 7030/10000 [00:25<00:10, 270.50it/s]     71%|███████   | 7058/10000 [00:26<00:10, 271.65it/s]     71%|███████   | 7086/10000 [00:26<00:10, 271.94it/s]     71%|███████   | 7114/10000 [00:26<00:10, 271.33it/s]     71%|███████▏  | 7142/10000 [00:26<00:10, 272.06it/s]     72%|███████▏  | 7170/10000 [00:26<00:10, 270.87it/s]     72%|███████▏  | 7198/10000 [00:26<00:10, 269.45it/s]     72%|███████▏  | 7226/10000 [00:26<00:10, 270.46it/s]     73%|███████▎  | 7254/10000 [00:26<00:10, 271.53it/s]     73%|███████▎  | 7282/10000 [00:26<00:10, 270.90it/s]     73%|███████▎  | 7310/10000 [00:27<00:09, 269.76it/s]     73%|███████▎  | 7338/10000 [00:27<00:09, 270.65it/s]     74%|███████▎  | 7366/10000 [00:27<00:09, 270.24it/s]     74%|███████▍  | 7394/10000 [00:27<00:09, 269.40it/s]     74%|███████▍  | 7421/10000 [00:27<00:09, 268.56it/s]     74%|███████▍  | 7449/10000 [00:27<00:09, 270.33it/s]     75%|███████▍  | 7477/10000 [00:27<00:09, 270.65it/s]     75%|███████▌  | 7505/10000 [00:27<00:09, 271.12it/s]     75%|███████▌  | 7533/10000 [00:27<00:09, 272.29it/s]     76%|███████▌  | 7561/10000 [00:27<00:08, 272.27it/s]     76%|███████▌  | 7589/10000 [00:28<00:08, 273.41it/s]     76%|███████▌  | 7618/10000 [00:28<00:08, 277.74it/s]     76%|███████▋  | 7646/10000 [00:28<00:08, 277.85it/s]     77%|███████▋  | 7675/10000 [00:28<00:08, 278.44it/s]     77%|███████▋  | 7703/10000 [00:28<00:08, 278.18it/s]     77%|███████▋  | 7731/10000 [00:28<00:08, 277.73it/s]     78%|███████▊  | 7759/10000 [00:28<00:08, 276.04it/s]     78%|███████▊  | 7787/10000 [00:28<00:07, 277.02it/s]     78%|███████▊  | 7815/10000 [00:28<00:07, 275.75it/s]     78%|███████▊  | 7843/10000 [00:28<00:07, 274.62it/s]     79%|███████▊  | 7871/10000 [00:29<00:07, 275.71it/s]     79%|███████▉  | 7899/10000 [00:29<00:07, 273.64it/s]     79%|███████▉  | 7927/10000 [00:29<00:07, 273.90it/s]     80%|███████▉  | 7955/10000 [00:29<00:07, 273.68it/s]     80%|███████▉  | 7983/10000 [00:29<00:07, 274.99it/s]     80%|████████  | 8011/10000 [00:29<00:07, 273.62it/s]     80%|████████  | 8039/10000 [00:29<00:07, 274.45it/s]     81%|████████  | 8067/10000 [00:29<00:07, 272.55it/s]     81%|████████  | 8095/10000 [00:29<00:07, 271.33it/s]     81%|████████  | 8123/10000 [00:29<00:06, 271.61it/s]     82%|████████▏ | 8151/10000 [00:30<00:06, 273.26it/s]     82%|████████▏ | 8179/10000 [00:30<00:06, 272.24it/s]     82%|████████▏ | 8207/10000 [00:30<00:06, 269.79it/s]     82%|████████▏ | 8235/10000 [00:30<00:06, 271.59it/s]     83%|████████▎ | 8263/10000 [00:30<00:06, 271.48it/s]     83%|████████▎ | 8291/10000 [00:30<00:06, 270.21it/s]     83%|████████▎ | 8319/10000 [00:30<00:06, 270.27it/s]     83%|████████▎ | 8347/10000 [00:30<00:06, 272.26it/s]     84%|████████▍ | 8375/10000 [00:30<00:06, 269.92it/s]     84%|████████▍ | 8403/10000 [00:31<00:05, 269.33it/s]     84%|████████▍ | 8431/10000 [00:31<00:05, 270.54it/s]     85%|████████▍ | 8459/10000 [00:31<00:05, 271.19it/s]     85%|████████▍ | 8487/10000 [00:31<00:05, 271.72it/s]     85%|████████▌ | 8515/10000 [00:31<00:05, 271.30it/s]     85%|████████▌ | 8543/10000 [00:31<00:05, 271.30it/s]     86%|████████▌ | 8571/10000 [00:31<00:05, 272.65it/s]     86%|████████▌ | 8599/10000 [00:31<00:05, 274.20it/s]     86%|████████▋ | 8627/10000 [00:31<00:05, 274.22it/s]     87%|████████▋ | 8655/10000 [00:31<00:04, 274.42it/s]     87%|████████▋ | 8683/10000 [00:32<00:04, 274.20it/s]     87%|████████▋ | 8711/10000 [00:32<00:04, 271.64it/s]     87%|████████▋ | 8739/10000 [00:32<00:04, 270.68it/s]     88%|████████▊ | 8767/10000 [00:32<00:04, 270.63it/s]     88%|████████▊ | 8795/10000 [00:32<00:04, 270.04it/s]     88%|████████▊ | 8823/10000 [00:32<00:04, 272.45it/s]     89%|████████▊ | 8851/10000 [00:32<00:04, 273.72it/s]     89%|████████▉ | 8879/10000 [00:32<00:04, 274.98it/s]     89%|████████▉ | 8907/10000 [00:32<00:03, 274.13it/s]     89%|████████▉ | 8935/10000 [00:32<00:03, 270.81it/s]     90%|████████▉ | 8963/10000 [00:33<00:03, 272.00it/s]     90%|████████▉ | 8991/10000 [00:33<00:03, 272.00it/s]     90%|█████████ | 9019/10000 [00:33<00:03, 273.52it/s]     90%|█████████ | 9047/10000 [00:33<00:03, 275.01it/s]     91%|█████████ | 9075/10000 [00:33<00:03, 276.36it/s]     91%|█████████ | 9103/10000 [00:33<00:03, 275.93it/s]     91%|█████████▏| 9131/10000 [00:33<00:03, 275.28it/s]     92%|█████████▏| 9159/10000 [00:33<00:03, 276.32it/s]     92%|█████████▏| 9187/10000 [00:33<00:02, 275.72it/s]     92%|█████████▏| 9215/10000 [00:34<00:02, 274.46it/s]     92%|█████████▏| 9243/10000 [00:34<00:02, 275.75it/s]     93%|█████████▎| 9271/10000 [00:34<00:02, 272.55it/s]     93%|█████████▎| 9299/10000 [00:34<00:02, 272.80it/s]     93%|█████████▎| 9327/10000 [00:34<00:02, 273.08it/s]     94%|█████████▎| 9355/10000 [00:34<00:02, 273.43it/s]     94%|█████████▍| 9383/10000 [00:34<00:02, 272.68it/s]     94%|█████████▍| 9411/10000 [00:34<00:02, 270.95it/s]     94%|█████████▍| 9439/10000 [00:34<00:02, 270.16it/s]     95%|█████████▍| 9467/10000 [00:34<00:01, 269.72it/s]     95%|█████████▍| 9495/10000 [00:35<00:01, 271.02it/s]     95%|█████████▌| 9523/10000 [00:35<00:01, 272.99it/s]     96%|█████████▌| 9551/10000 [00:35<00:01, 274.78it/s]     96%|█████████▌| 9579/10000 [00:35<00:01, 275.16it/s]     96%|█████████▌| 9607/10000 [00:35<00:01, 274.21it/s]     96%|█████████▋| 9635/10000 [00:35<00:01, 273.80it/s]     97%|█████████▋| 9663/10000 [00:35<00:01, 271.38it/s]     97%|█████████▋| 9691/10000 [00:35<00:01, 270.75it/s]     97%|█████████▋| 9719/10000 [00:35<00:01, 272.19it/s]     97%|█████████▋| 9747/10000 [00:35<00:00, 269.68it/s]     98%|█████████▊| 9775/10000 [00:36<00:00, 271.14it/s]     98%|█████████▊| 9803/10000 [00:36<00:00, 268.33it/s]     98%|█████████▊| 9831/10000 [00:36<00:00, 269.46it/s]     99%|█████████▊| 9859/10000 [00:36<00:00, 271.88it/s]     99%|█████████▉| 9887/10000 [00:36<00:00, 273.47it/s]     99%|█████████▉| 9915/10000 [00:36<00:00, 274.11it/s]     99%|█████████▉| 9943/10000 [00:36<00:00, 273.97it/s]    100%|█████████▉| 9972/10000 [00:36<00:00, 277.25it/s]    100%|██████████| 10000/10000 [00:36<00:00, 273.87it/s]    100%|██████████| 10000/10000 [00:36<00:00, 271.13it/s]




.. GENERATED FROM PYTHON SOURCE LINES 202-204

Finally, we can analyze the MCMC results to see how well we recovered the original parameters.
Frequencies for plotting

.. GENERATED FROM PYTHON SOURCE LINES 204-244

.. code-block:: Python

    freqs_plot = np.logspace(8, 11, 200) * u.Hz

    fig, ax = plt.subplots(figsize=(10, 6))

    # Plot data
    ax.errorbar(
        frequencies.to_value(u.GHz),
        synthetic_flux.to_value(u.mJy),
        yerr=noise_fraction * synthetic_flux.to_value(u.mJy),
        fmt="o",
        color="red",
        label="Data",
    )

    # Draw a subset of posterior samples
    n_draw = 100
    idx = np.random.choice(samples.shape[0], n_draw, replace=False)

    for i in idx:
        theta_free = samples[i]
        params = problem.unpack_free_parameters(theta_free)
        flux = sed_model.forward_model({"frequency": freqs_plot}, params)["flux_density"]

        ax.plot(freqs_plot.to_value(u.GHz), flux.to_value(u.mJy), color="C0", alpha=0.05)

    # Plot true model
    true_flux_plot = sed_model.forward_model({"frequency": freqs_plot}, true_params)["flux_density"]

    ax.axhline(flux_floor.to_value("mJy"), color="black", ls="--", label="Flux Limit")

    ax.plot(freqs_plot.to_value(u.GHz), true_flux_plot.to_value(u.mJy), color="black", lw=2, label="True Model")

    ax.set_xscale("log")
    ax.set_yscale("log")
    ax.set_xlabel("Frequency [GHz]")
    ax.set_ylabel("Flux Density [mJy]")
    ax.legend()

    plt.show()




.. image-sg:: /auto_examples/b_inference/images/sphx_glr_plot_censored_SED_fit_002.png
   :alt: plot censored SED fit
   :srcset: /auto_examples/b_inference/images/sphx_glr_plot_censored_SED_fit_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 245-250

It's also always good practice to look at some diagnostic plots to ensure that the MCMC
chains have converged and that the posterior distributions look reasonable. We'll use the built-in plotting utilities
in Triceratops for this.

Let's start by looking at the trace plots for the :math:`\nu_{\rm brk}` parameter.

.. GENERATED FROM PYTHON SOURCE LINES 250-253

.. code-block:: Python

    fig, ax = result.trace_plot("nu_break", burn=1000, thin=5)
    plt.show()




.. image-sg:: /auto_examples/b_inference/images/sphx_glr_plot_censored_SED_fit_003.png
   :alt: Trace plot: nu_break
   :srcset: /auto_examples/b_inference/images/sphx_glr_plot_censored_SED_fit_003.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 254-255

Let's also look at the corner plot for all the parameters to see their posterior distributions and covariances.

.. GENERATED FROM PYTHON SOURCE LINES 255-257

.. code-block:: Python

    fig = result.corner_plot(burn=1000, thin=5, parameters=["norm", "nu_break", "p"])
    plt.show()



.. image-sg:: /auto_examples/b_inference/images/sphx_glr_plot_censored_SED_fit_004.png
   :alt: norm = ${0.0042}_{-0.000752}^{+0.000854}$, nu_break = ${3.33}_{-0.751}^{+1.3}$, p = ${2.59}_{-0.36}^{+0.515}$
   :srcset: /auto_examples/b_inference/images/sphx_glr_plot_censored_SED_fit_004.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 38.137 seconds)


.. _sphx_glr_download_auto_examples_b_inference_plot_censored_SED_fit.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_censored_SED_fit.ipynb <plot_censored_SED_fit.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_censored_SED_fit.py <plot_censored_SED_fit.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_censored_SED_fit.zip <plot_censored_SED_fit.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
